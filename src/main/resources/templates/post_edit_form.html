<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">
<head>
    <title>Edit Post</title>
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>
<div layout:fragment="content">
    <h1>Edit Post</h1>
    <form id="editPostForm" th:action="@{'/posts/edit/' + ${postId}}" th:object="${postFormDto}" method="post">
        <div class="form-group">
            <label for="author">Author</label>
            <input type="text" th:field="*{author}" class="form-control" id="author" placeholder="Enter author" required>
        </div>
        <div class="form-group">
            <label for="title">Title</label>
            <input type="text" th:field="*{title}" class="form-control" id="title" placeholder="Enter title" required>
        </div>
        <div class="form-group">
            <label for="content">Content</label>
            <textarea th:field="*{content}" class="form-control" id="content" placeholder="Enter content" required></textarea>
        </div>
        <div class="form-group">
            <label for="postDate">Date</label>
            <input type="date" th:field="*{postDate}" class="form-control" id="postDate" required>
        </div>
        <button type="button" id="updateButton" class="btn btn-primary">Update</button>
    </form>
</div>
<th:block layout:fragment="script">
    <script th:inline="javascript">
    function updatePost() {
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");

        var postId = /*[[${postId}]]*/'';
        var postData = {
            title: $('#title').val(),
            content: $('#content').val(),
            postDate: $('#postDate').val(),
            author: $('#author').val()
        };

        $.ajax({
            url: '/posts/edit/' + postId,
            type: 'PATCH',
            contentType: 'application/json',
            data: JSON.stringify(postData),
            beforeSend: function(xhr) {
                xhr.setRequestHeader(header, token);
            },
            success: function(result) {
                alert('Post updated successfully.');
                window.location.href = '/posts';
            },
            error: function(xhr, status, error) {
                alert('Error updating postEntity: ' + error);
            }
        });
    }

    $(document).ready(function() {
        $('#updateButton').click(function() {
            updatePost();
        });
    });
    </script>
</th:block>
</body>
</html>