<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/layout1}">
<head>
    <meta charset="UTF-8" />
    <title>메인 페이지</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>

<th:block layout:fragment="script">
    <script th:inline="javascript">
        $(document).ready(function () {
            var ctx = document.getElementById('genreStatisticsChart').getContext('2d');
            var chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: /*[[${genreLabels}]]*/ [],
                    datasets: [
                        {
                            label: '공연건수',
                            data: /*[[${performanceCounts}]]*/ [],
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1,
                            yAxisID: 'y-axis-1'
                        },
                        {
                            label: '총 티켓판매액',
                            data: /*[[${totalTicketRevenues}]]*/ [],
                            backgroundColor: 'rgba(255, 99, 132, 0.5)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1,
                            type: 'line',
                            yAxisID: 'y-axis-2'
                        }
                    ]
                },
                options: {
                    scales: {
                        'y-axis-1': {
                            type: 'linear',
                            position: 'left'
                        },
                        'y-axis-2': {
                            type: 'linear',
                            position: 'right',
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });

            var currentIndex = 0;
            var itemsPerPage = 5;
            var totalItems = $('.award-item').length;

            function updateAwards() {
                $('.award-item').hide().slice(currentIndex, currentIndex + itemsPerPage).show();
            }

            $('#prevBtn').click(function () {
                if (currentIndex > 0) {
                    currentIndex--;
                    updateAwards();
                }
            });

            $('#nextBtn').click(function () {
                if (currentIndex + itemsPerPage < totalItems) {
                    currentIndex++;
                    updateAwards();
                }
            });

            updateAwards();

            // Pagination for table
            var rowsPerPage = 6;
            var rows = $('.statistics-table tbody tr');
            var totalRows = rows.length;
            var pageCount = Math.ceil(totalRows / rowsPerPage);
            var currentPage = 1;

            function displayRows() {
                var start = (currentPage - 1) * rowsPerPage;
                var end = start + rowsPerPage;
                rows.hide().slice(start, end).show();
            }

            function createPagination() {
                var pagination = $('<div class="pagination mt-2"></div>');
                for (var i = 1; i <= pageCount; i++) {
                    pagination.append('<button class="page-link" data-page="' + i + '">' + i + '</button>');
                }
                $('.pagination-container').append(pagination);

                $('.page-link').on('click', function () {
                    currentPage = $(this).data('page');
                    displayRows();
                    $('.page-link').removeClass('active');
                    $(this).addClass('active');
                });

                $('.page-link:first').addClass('active');
            }

            displayRows();
            createPagination();
        });
    </script>
</th:block>

<th:block layout:fragment="css">
    <style>
        .custom-container {
            margin: 0 auto;
            padding: 20px;
            max-width: 1400px; /* 컨테이너의 최대 너비를 늘립니다 */
            margin-top: 100px; /* 추가: 컨텐츠를 아래로 내리기 위해 여백을 추가 */
        }
        .carousel-item img {
            max-height: 400px; /* 이미지의 최대 높이를 설정합니다 */
            object-fit: cover; /* 이미지가 컨테이너를 덮도록 설정합니다 */
        }
        .custom-card {
            width: 23%; /* 네 개씩 나오도록 너비 조정 */
            margin: 10px 10px; /* 여백 추가 */
            border: 2px solid gold; /* 테두리를 금색으로 설정 */
            border-radius: 8px;
            overflow: hidden;
            text-align: center;
            display: inline-block;
            background-color: #fffbe6; /* 카드 배경색을 연한 금색으로 설정 */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 카드 그림자 */
        }
        .custom-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }
        .custom-card-body {
            padding: 20px;
        }
        .custom-card-body h6 {
            font-size: 20px;
            margin-bottom: 10px;
        }
        .custom-card-body p {
            font-size: 16px;
            margin: 5px 0;
        }
        .carousel-controls {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            display: flex;
            justify-content: space-between;
            z-index: 10; /* z-index 값을 높게 설정하여 앞에 오도록 합니다 */
        }
        .carousel-control-prev, .carousel-control-next {
            width: 40px;
            height: 40px;
            background-color: transparent; /* 원형 모양을 없애기 위해 배경을 투명으로 설정 */
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 11; /* 버튼의 z-index 값을 높게 설정합니다 */
        }
        .carousel-control-prev {
            left: 0; /* 왼쪽 버튼 위치 조정 */
            color: #f8d7da;
            opacity: 100;
        }
        .carousel-control-next {
            right: 0; /* 오른쪽 버튼 위치 조정 */
            color: #f8d7da;
            opacity: 100;
        }
        .carousel-container {
            position: relative;
            margin-bottom: 75px; /* 추가: 카로셀과 수상 목록 사이에 여백을 추가합니다 */
            margin-top: 75px;
        }
        .carousel-inner {
            display: flex;
            flex-wrap: nowrap;
            overflow: hidden;
            position: relative;
        }
        .carousel-item {
            flex: 0 0 100%;
            max-width: 100%;
            transition: transform 1s ease; /* 전환 시간을 늘립니다 */
        }
        .carousel-item img {
            width: 100%;
            height: auto;
        }
        .statistics-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-top: 20px;
        }
        .statistics-container canvas {
            max-width: 600px;
            max-height: 400px;
        }
        .statistics-table {
            max-width: 600px;
            overflow-x: auto;
        }
        .statistics-table table {
            width: 100%;
            font-size: 0.9rem;
        }
        .pagination-container {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }
        .page-link {
            margin: 0 5px;
            padding: 5px 10px;
            border: 1px solid #dee2e6;
            cursor: pointer;
        }
        .page-link.active {
            background-color: #f8d7da;
            color: white;
            border-color: #f8d7da;
        }
        .table {
            --bs-table-color-type: initial;
            --bs-table-bg-type: initial;
            --bs-table-color-state: initial;
            --bs-table-bg-state: initial;
            --bs-table-color: #212529;
            --bs-table-bg: var(--bs-body-bg);
            --bs-table-border-color: #f8d7da;
            --bs-table-accent-bg: #f8d7da;
            --bs-table-striped-color: #000;
            --bs-table-striped-bg: #fff;
            --bs-table-active-color: var(--bs-body-color);
            --bs-table-active-bg: rgba(0, 0, 0, 0.1);
            --bs-table-hover-color: var(--bs-body-color);
            --bs-table-hover-bg: rgba(0, 0, 0, 0.075);
            width: 100%;
            margin-bottom: 1rem;
            vertical-align: top;
            border-color: var(--bs-table-border-color);
        }
    </style>
</th:block>

<div layout:fragment="content">
    <div class="custom-container text-center">
        <div id="carouselExampleControls" class="carousel slide" data-ride="carousel" data-interval="4000">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img class="d-block w-100" src="/img/mainImage03.jpg">
                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src="/img/mainImage01.jpg">
                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src="/img/mainImage04.jpg">
                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src="/img/mainImage02.jpg">
                </div>
            </div>
            <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>

        <div class="carousel-container">
            <h5>수상작</h5>
            <div class="carousel-controls">
                <button id="prevBtn" class="carousel-control-prev">
                    <i class="fas fa-chevron-left"></i>
                    <span class="sr-only">Previous</span>
                </button>
                <button id="nextBtn" class="carousel-control-next">
                    <i class="fas fa-chevron-right"></i>
                    <span class="sr-only">Next</span>
                </button>
            </div>


            <div class="carousel-inner">
                <th:block th:each="award : ${topAwards}">
                        <div class="custom-card award-item">
                            <img th:src="${award.posterUrl}" th:alt="${award.title}" />
                            <div class="custom-card-body">
                                <h6 th:text="${award.title}">제목</h6>
                                <p th:text="${award.stDate} + ' ~ ' + ${award.edDate}">기간</p>
                            </div>
                        </div>
                    </a>
                </th:block>
            </div>
        </div>
        <hr>

        <div class="statistics-container">
            <h5>장르별 통계</h5>
            <canvas id="genreStatisticsChart"></canvas>
            <div class="statistics-table">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>장르</th>
                        <th>공연건수</th>
                        <th>상연횟수</th>
                        <th>예매수</th>
                        <th>취소수</th>
                        <th>총 티켓판매수</th>
                        <th>총 티켓판매액</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="stat : ${genreStatistics}">
                        <td th:text="${stat.genre}"></td>
                        <td th:text="${stat.performanceCount}"></td>
                        <td th:text="${stat.showCount}"></td>
                        <td th:text="${stat.reservationCount}"></td>
                        <td th:text="${stat.cancellationCount}"></td>
                        <td th:text="${stat.totalTicketSales}"></td>
                        <td th:text="${stat.totalTicketRevenue}"></td>
                    </tr>
                    </tbody>
                </table>
                <div class="pagination-container"></div>
            </div>
        </div>
    </div>
</div>
</html>
