<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/layout1}">
<head>
    <meta charset="UTF-8" />
    <title>메인 페이지</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>

<th:block layout:fragment="script">
    <script th:inline="javascript">
        $(document).ready(function () {
            var ctx = document.getElementById('genreStatisticsChart').getContext('2d');
            var chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: /*[[${genreLabels}]]*/ [],
                    datasets: [
                        {
                            label: '공연건수',
                            data: /*[[${performanceCounts}]]*/ [],
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1,
                            yAxisID: 'y-axis-1'
                        },
                        {
                            label: '총 티켓판매액',
                            data: /*[[${totalTicketRevenues}]]*/ [],
                            backgroundColor: 'rgba(255, 99, 132, 0.5)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1,
                            type: 'line',
                            yAxisID: 'y-axis-2'
                        }
                    ]
                },
                options: {
                    scales: {
                        'y-axis-1': {
                            type: 'linear',
                            position: 'left'
                        },
                        'y-axis-2': {
                            type: 'linear',
                            position: 'right',
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });

            var currentIndex = 0;
            var itemsPerPage = 4;
            var totalItems = $('.award-item').length;

            function updateAwards() {
                var start = currentIndex * itemsPerPage;
                var end = start + itemsPerPage;
                $('.award-item').hide().slice(start, end).show();
            }

            $('#prevBtn').click(function () {
                if (currentIndex > 0) {
                    currentIndex--;
                    updateAwards();
                }
            });

            $('#nextBtn').click(function () {
                if ((currentIndex + 1) * itemsPerPage < totalItems) {
                    currentIndex++;
                    updateAwards();
                }
            });

            updateAwards();

            // Pagination for table
            var rowsPerPage = 6;
            var rows = $('.statistics-table tbody tr');
            var totalRows = rows.length;
            var pageCount = Math.ceil(totalRows / rowsPerPage);
            var currentPage = 1;

            function displayRows() {
                var start = (currentPage - 1) * rowsPerPage;
                var end = start + rowsPerPage;
                rows.hide().slice(start, end).show();
            }

            function createPagination() {
                var pagination = $('<div class="pagination mt-2"></div>');
                for (var i = 1; i <= pageCount; i++) {
                    pagination.append('<button class="page-link" data-page="' + i + '">' + i + '</button>');
                }
                $('.pagination-container').append(pagination);

                $('.page-link').on('click', function () {
                    currentPage = $(this).data('page');
                    displayRows();
                    $('.page-link').removeClass('active');
                    $(this).addClass('active');
                });

                $('.page-link:first').addClass('active');
            }

            displayRows();
            createPagination();
        });
    </script>
</th:block>

<th:block layout:fragment="css">
    <style>
        .custom-container {
            margin: 0 auto;
            padding: 20px;
            max-width: 1200px;
        }
        .custom-card {
            width: 23%; /* 네 개씩 나오도록 너비 조정 */
            margin: 10px 10px; /* 여백 추가 */
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
            text-align: center;
            display: inline-block;
        }
        .custom-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }
        .custom-card-body {
            padding: 10px;
        }
        .custom-card-body h6 {
            font-size: 16px;
            margin-bottom: 10px;
        }
        .custom-card-body p {
            font-size: 14px;
            margin: 5px 0;
        }
        .carousel-controls {
            position: relative;
            width: 100%;
        }
        .carousel-control-prev, .carousel-control-next {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background-color: rgba(0, 0, 0, 0.75);
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }
        .carousel-control-prev {
            left: -20px;
        }
        .carousel-control-next {
            right: -20px;
        }
        .carousel-container {
            position: relative;
        }
        .carousel-inner {
            display: flex;
            flex-wrap: nowrap;
            overflow: hidden;
            position: relative;
        }
        .statistics-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-top: 20px;
        }
        .statistics-container canvas {
            max-width: 600px;
            max-height: 400px;
        }
        .statistics-table {
            max-width: 600px;
            overflow-x: auto;
        }
        .statistics-table table {
            width: 100%;
            font-size: 0.9rem;
        }
        .pagination-container {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }
        .page-link {
            margin: 0 5px;
            padding: 5px 10px;
            border: 1px solid #dee2e6;
            cursor: pointer;
        }
        .page-link.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
    </style>
</th:block>

<div layout:fragment="content">
    <div class="custom-container text-center">
        <h1>수상 목록</h1>
        <div class="carousel-container">
            <button id="prevBtn" class="carousel-control-prev">
                <i class="fas fa-chevron-left"></i>
                <span class="sr-only">Previous</span>
            </button>
            <div class="carousel-inner">
                <th:block th:each="award : ${topAwards}">
                    <div class="custom-card award-item">
                        <img th:src="${award.posterUrl}" th:alt="${award.title}" />
                        <div class="custom-card-body">
                            <h6 th:text="${award.title}">제목</h6>
                            <p th:text="${award.stDate} + ' ~ ' + ${award.edDate}">기간</p>
                        </div>
                    </div>
                </th:block>
            </div>
            <button id="nextBtn" class="carousel-control-next">
                <i class="fas fa-chevron-right"></i>
                <span class="sr-only">Next</span>
            </button>
        </div>
        <hr>
        <h1>장르별 통계</h1>
        <div class="statistics-container">
            <canvas id="genreStatisticsChart"></canvas>
            <div class="statistics-table">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>장르</th>
                        <th>공연건수</th>
                        <th>상연횟수</th>
                        <th>예매수</th>
                        <th>취소수</th>
                        <th>총 티켓판매수</th>
                        <th>총 티켓판매액</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="stat : ${genreStatistics}">
                        <td th:text="${stat.genre}"></td>
                        <td th:text="${stat.performanceCount}"></td>
                        <td th:text="${stat.showCount}"></td>
                        <td th:text="${stat.reservationCount}"></td>
                        <td th:text="${stat.cancellationCount}"></td>
                        <td th:text="${stat.totalTicketSales}"></td>
                        <td th:text="${stat.totalTicketRevenue}"></td>
                    </tr>
                    </tbody>
                </table>
                <div class="pagination-container"></div>
            </div>
        </div>
    </div>
</div>
</html>
